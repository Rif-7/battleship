(()=>{"use strict";var e=document.querySelector(".player-board"),t=document.querySelector(".com-board"),n=document.querySelector(".result-modal"),r=document.querySelector(".winner-details"),o="#32CD32",i="#D2122E";function a(e){e.innerHTML="";for(var t=0;t<10;t++){var n=document.createElement("div");n.classList.add("row");for(var r=0;r<10;r++){var o=document.createElement("div");o.classList.add("cell"),o.setAttribute("data-cordA",t),o.setAttribute("data-cordB",r),n.appendChild(o)}e.appendChild(n)}}function c(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"highlighted",r=0;r<t.length;r++){var o=t[r];try{var i=e.querySelector(".cell[data-corda='".concat(o[0],"'][data-cordb='").concat(o[1],"']"));i.classList.add(n)}catch(e){continue}}}function u(){n.style.display="block",t.classList.add("disabled-div")}function s(e,t,n,r){e.setPositions(n,r);var o=e.positions;e.positions=[];for(var i=0;i<e.body.length;i++){var a=o[i];if(t.gameBoard.isShip(a[0],a[1]))return!1}return e.positions=o,!!t.isValidPosition(e)||(e.positions=[],!1)}function d(e,t){return Math.floor(Math.random()*(t-e+1))+e}function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function h(e,t){if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var b=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ship";v(this,e),this.name=n,this.body=Array.from({length:t}).fill(!1),this.positions=[]}return m(e,[{key:"hit",value:function(e){if(e>this.body.length-1)throw new Error("Index out of range");return this.body[e]=!0,this}},{key:"getPositions",value:function(e,t){var n=[];function r(t){for(var r=0;r<this.body.length;r++)n.push(t(e[0],e[1],r))}switch(t){case"r":r.call(this,(function(e,t,n){return[e,t+n]}));break;case"l":r.call(this,(function(e,t,n){return[e,t-n]}));break;case"u":r.call(this,(function(e,t,n){return[e-n,t]}));break;case"d":r.call(this,(function(e,t,n){return[e+n,t]}));break;default:throw Error("Invaid direction specified")}return n}},{key:"setPositions",value:function(e,t){this.positions=this.getPositions(e,t)}},{key:"isSunk",value:function(){return!this.body.includes(!1)}}]),e}(),g=function(){function e(){v(this,e),this.gameBoard=function(){var e=[],t=function(){for(var e=[],t=0;t<10;t++)for(var n=0;n<10;n++)e.push([t,n]);return e}();function n(t,n){for(var r=0;r<e.length;r++){var o=e[r];if(o.positions.length)for(var i=0;i<o.body.length;i++){var a=o.positions[i];if(a[0]===t&&a[1]===n)return{shipIndex:r,position:i}}}return!1}return{isShip:n,addShip:function(t){e.push(t)},recieveAttack:function(t,r){var o=n(t,r);return!!o&&(e[o.shipIndex].hit(o.position),!0)},getFreeIndexes:function(){return t},editFreeIndex:function(e){t.splice(e,1)},getShips:function(){return e},checkIfAllShipsSank:function(){return e.every((function(e){return e.isSunk()}))},boardSize:10}}()}return m(e,[{key:"addShips",value:function(){this.gameBoard.addShip(new b(2,"Small Ship")),this.gameBoard.addShip(new b(3,"Medium Ship")),this.gameBoard.addShip(new b(4,"Large Ship"))}},{key:"isValidPosition",value:function(e){var t=e.positions.at(-1);return this.checkPosition(t)}},{key:"checkPosition",value:function(e){var t=this.gameBoard.boardSize;return!(e[0]>=t||e[1]>=t||e[0]<0||e[1]<0)}}]),e}(),S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=p(t);if(n){var o=p(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return h(this,e)});function o(){var e;return v(this,o),(e=r.call(this)).previousHit={wasHit:!1,indexes:[],index:null},e}return m(o,[{key:"makeRandomChoice",value:function(){var e=this.gameBoard.getFreeIndexes();if(!e.length)return null;var t=Math.floor(Math.random()*e.length);this.previousHit.wasHit?(t=this.previousHit.index,this.previousHit.indexes=[t,t-1,t+7,t-9],this.previousHit.indexes.splice(0,1)):this.previousHit.indexes.length>0&&(t=this.previousHit.indexes[0],this.previousHit.indexes.splice(0,1));var n=e.at(t);return n||(t=Math.floor(Math.random()*e.length),n=e.at(t)),this.previousHit.index=t,this.gameBoard.editFreeIndex(t),n}},{key:"positionShipRandomly",value:function(e){var t,n,r=["r","l","u","d"][Math.floor(4*Math.random())],o=this.gameBoard.boardSize,i=e.body.length;switch(r){case"r":t=d(0,o-1),n=d(0,o-i);break;case"l":t=d(0,o-1),n=d(i,o-1);break;case"u":t=d(i,o-1),n=d(0,o-1);break;case"d":t=d(0,o-i),n=d(0,o-1);break;default:throw Error("Invaid direction")}e.setPositions([t,n],r)}}]),o}(g);function k(){var d=new g;d.addShips();var l=new S;l.addShips(),function(){document.querySelector(".new-game-modal").style.display="block";var e=document.querySelector(".preview-board");e.innerHTML="",a(e)}(),a(e),a(t),document.querySelector(".close-btn").addEventListener("click",(function(){n.style.display="none"})),t.classList.remove("disabled-div");var f=new Promise((function(e){!function(e,t){var n=0,r=document.querySelector(".preview-board"),o=e.gameBoard.getShips(),i=o[n],a="r",u=[],d=document.querySelector(".ship-no");document.querySelector(".change-direction").addEventListener("click",(function(){a="r"===a?"d":"r"})),d.textContent="1/".concat(o.length),r.querySelectorAll(".cell").forEach((function(l){var f=Number(l.getAttribute("data-corda")),h=Number(l.getAttribute("data-cordb"));l.addEventListener("mouseover",(function(){var t=i.getPositions([f,h],a);if(e.checkPosition(t.at(-1))&&s(i,e,[f,h],a)){c(r,t),u=[l];for(var n=1;n<t.length;n++){var o=t[n],d=r.querySelector(".cell[data-corda='".concat(o[0],"'][data-cordb='").concat(o[1],"']"));d&&u.push(d)}}})),l.addEventListener("mouseout",(function(){u.forEach((function(e){e.classList.remove("highlighted")})),u=[]})),l.addEventListener("click",(function(){if(s(i,e,[f,h],a)){if(c(r,i.positions,"selected"),u=[],n++,d.textContent="".concat(n+1,"/").concat(o.length),n>o.length-1)return void t("success");i=o[n]}}))}))}(d,e)}));f.then((function(){document.querySelector(".new-game-modal").style.display="none";for(var e=document.querySelector(".player-board"),t=d.gameBoard.getShips(),n=0;n<t.length;n++)c(e,t[n].positions)})).catch((function(e){console.log(e)})),setTimeout((function(){for(var e=l.gameBoard.getShips(),t=0;t<e.length;t++){var n=e[t];l.positionShipRandomly(n);var r=n.positions;n.positions=[];for(var o=!0,i=0;i<r.length;i++){var a=r[i];if(l.gameBoard.isShip(a[0],a[1])){o=!1;break}}o?n.positions=r:t--}}),0),function(e,n){t.querySelectorAll(".cell").forEach((function(t){var a=t.getAttribute("data-corda"),c=t.getAttribute("data-cordb");t.addEventListener("click",(function(){var s=e.gameBoard.recieveAttack(Number(a),Number(c));if(t.style.backgroundColor=s?i:o,e.gameBoard.checkIfAllShipsSank())return r.textContent="Player Won",void u();n()&&(r.textContent="Com Won",u())}),{once:!0})}))}(l,(function(){var t=l.makeRandomChoice(),n=d.gameBoard.recieveAttack(t[0],t[1]);return l.previousHit.wasHit=!!n,function(t,n,r){e.querySelector(".cell[data-corda='".concat(t,"'][data-cordb='").concat(n,"']")).style.backgroundColor=r?i:o}(t[0],t[1],n),!!d.gameBoard.checkIfAllShipsSank()}))}document.addEventListener("DOMContentLoaded",(function(){k(),document.querySelector(".start-btn").addEventListener("click",k)}))})();